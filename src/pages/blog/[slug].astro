---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import MainLayout from '../../components/Layout.tsx';
import { Calendar, Clock, User, ArrowLeft, Tag, Share2, BookOpen } from 'lucide-react';

export const prerender = true;

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

const post = Astro.props;
const { Content } = await post.render();

const allPosts = await getCollection('blog');
const relatedPosts = allPosts
  .filter(p => p.data.category === post.data.category && p.slug !== post.slug)
  .slice(0, 3);
---

<Layout
	title={`${post.data.title} - Hosting Sistemas Chile`}
	description={post.data.description}
	canonical={`/blog/${post.slug}`}
>
	<!-- Article Schema Markup -->
	<script type="application/ld+json">
	{
		"@context": "https://schema.org",
		"@type": "BlogPosting",
		"@id": {JSON.stringify(`https://hostingsistemas.cl/blog/${post.slug}#article`)},
		"headline": {JSON.stringify(post.data.title)},
		"description": {JSON.stringify(post.data.description)},
		"image": {
			"@type": "ImageObject",
			"url": "https://hostingsistemas.cl/og-image.jpg",
			"width": 1200,
			"height": 630
		},
		"author": {
			"@type": "Organization",
			"name": {JSON.stringify(post.data.author)},
			"url": "https://hostingsistemas.cl",
			"logo": {
				"@type": "ImageObject",
				"url": "https://hostingsistemas.cl/logo.png"
			}
		},
		"publisher": {
			"@type": "Organization",
			"name": "Hosting Sistemas",
			"url": "https://hostingsistemas.cl",
			"logo": {
				"@type": "ImageObject",
				"url": "https://hostingsistemas.cl/logo.png",
				"width": 200,
				"height": 60
			}
		},
		"datePublished": {JSON.stringify(post.data.pubDate.toISOString())},
		"dateModified": {JSON.stringify(new Date().toISOString())},
		"mainEntityOfPage": {
			"@type": "WebPage",
			"@id": {JSON.stringify(`https://hostingsistemas.cl/blog/${post.slug}`)}
		},
		"articleSection": {JSON.stringify(post.data.category)},
		"keywords": {JSON.stringify(post.data.tags.join(', '))},
		"inLanguage": "es-CL",
		"wordCount": 2500,
		"timeRequired": "PT10M",
		"isPartOf": {
			"@type": "Blog",
			"@id": "https://hostingsistemas.cl/blog#blog",
			"name": "Blog Hosting Sistemas",
			"url": "https://hostingsistemas.cl/blog"
		},
		"potentialAction": {
			"@type": "ReadAction",
			"target": {JSON.stringify(`https://hostingsistemas.cl/blog/${post.slug}`)}
		}
	}
	</script>

	<!-- Breadcrumb Schema -->
	<script type="application/ld+json">
	{
		"@context": "https://schema.org",
		"@type": "BreadcrumbList",
		"itemListElement": [
			{
				"@type": "ListItem",
				"position": 1,
				"name": "Inicio",
				"item": "https://hostingsistemas.cl"
			},
			{
				"@type": "ListItem",
				"position": 2,
				"name": "Blog",
				"item": "https://hostingsistemas.cl/blog"
			},
			{
				"@type": "ListItem",
				"position": 3,
				"name": {JSON.stringify(post.data.category)},
				"item": {JSON.stringify(`https://hostingsistemas.cl/blog?category=${encodeURIComponent(post.data.category)}`)}
			},
			{
				"@type": "ListItem",
				"position": 4,
				"name": {JSON.stringify(post.data.title)},
				"item": {JSON.stringify(`https://hostingsistemas.cl/blog/${post.slug}`)}
			}
		]
	}
	</script>

	<script is:inline>
		function shareArticle() {
			const title = document.title;
			const url = window.location.href;
			const text = document.querySelector('meta[name="description"]').content;

			if (navigator.share) {
				navigator.share({ title, text, url }).catch(() => {});
			} else {
				navigator.clipboard.writeText(url).then(() => {
					const button = event.target.closest('button');
					const originalText = button.innerHTML;
					button.innerHTML = '<svg class="h-4 w-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Copiado';
					setTimeout(() => { button.innerHTML = originalText; }, 2000);
				}).catch(() => {
					window.open(`https://wa.me/?text=${encodeURIComponent(title + ' - ' + url)}`, '_blank');
				});
			}
		}
	</script>

	<MainLayout client:load>
		<!-- Hero -->
		<div class="bg-hs-blue py-14 sm:py-20">
			<div class="mx-auto max-w-7xl px-6 lg:px-8">
				<div class="mx-auto max-w-4xl">
					<nav class="flex items-center gap-2 text-sm text-white/50 mb-6">
						<a href="/" class="hover:text-white/80 transition-colors duration-200">Inicio</a>
						<span>/</span>
						<a href="/blog" class="hover:text-white/80 transition-colors duration-200">Blog</a>
						<span>/</span>
						<span class="text-white/80">{post.data.category}</span>
					</nav>

					<div class="mb-4">
						<span class="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-white/10 border border-white/15 text-white/80">
							{post.data.category}
						</span>
					</div>

					<h1 class="text-3xl sm:text-4xl font-bold tracking-tight text-white leading-tight mb-5">
						{post.data.title}
					</h1>

					<div class="flex flex-wrap items-center gap-5 text-sm text-blue-100/60">
						<div class="flex items-center gap-1.5">
							<User className="h-4 w-4" />
							<span>{post.data.author}</span>
						</div>
						<div class="flex items-center gap-1.5">
							<Calendar className="h-4 w-4" />
							<time datetime={post.data.pubDate.toISOString()}>
								{post.data.pubDate.toLocaleDateString('es-CL', {
									year: 'numeric',
									month: 'long',
									day: 'numeric'
								})}
							</time>
						</div>
						<div class="flex items-center gap-1.5">
							<Clock className="h-4 w-4" />
							<span>5 min de lectura</span>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Content -->
		<div class="bg-white py-10 sm:py-14">
			<div class="mx-auto max-w-7xl px-6 lg:px-8">
				<div class="grid grid-cols-1 xl:grid-cols-[1fr_280px] gap-8 xl:gap-12">
					<!-- Main Content -->
					<article class="min-w-0">
						{post.data.image ? (
							<div class="mb-10 rounded-xl overflow-hidden border border-gray-200">
								<img
									src={post.data.image}
									alt={post.data.title}
									class="w-full h-auto"
								/>
							</div>
						) : (
							<div class="mb-10 rounded-xl overflow-hidden bg-gray-50 h-48 flex items-center justify-center border border-gray-200">
								<div class="text-center">
									<BookOpen className="h-8 w-8 mx-auto mb-2 text-gray-300" />
									<span class="text-xs text-gray-400 uppercase tracking-wider">{post.data.category}</span>
								</div>
							</div>
						)}

						<div class="prose prose-lg max-w-none
							prose-headings:font-bold prose-headings:text-gray-900
							prose-h1:text-4xl prose-h1:mb-8 prose-h1:mt-12
							prose-h2:text-3xl prose-h2:mb-6 prose-h2:mt-10
							prose-h3:text-2xl prose-h3:mb-4 prose-h3:mt-8
							prose-p:text-gray-600 prose-p:leading-relaxed prose-p:mb-4
							prose-a:text-hs-blue prose-a:no-underline hover:prose-a:text-hs-blue-light
							prose-strong:text-gray-900 prose-strong:font-semibold
							prose-ul:my-4 prose-ul:space-y-2
							prose-ol:my-4 prose-ol:space-y-2
							prose-li:text-gray-600
							prose-blockquote:border-l-4 prose-blockquote:border-hs-blue prose-blockquote:pl-6 prose-blockquote:italic prose-blockquote:text-gray-700 prose-blockquote:my-6
							prose-code:bg-gray-100 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:text-gray-800 prose-code:before:content-none prose-code:after:content-none
							prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:p-6 prose-pre:rounded-xl prose-pre:overflow-x-auto prose-pre:my-6">
							<Content />
						</div>

						<!-- Tags -->
						<div class="mt-10 pt-6 border-t border-gray-200">
							<div class="flex items-center gap-2 flex-wrap">
								<Tag className="h-4 w-4 text-gray-300" />
								{post.data.tags.map((tag: string) => (
									<span class="inline-flex items-center px-2.5 py-1 rounded text-xs bg-gray-100 text-gray-500">
										{tag}
									</span>
								))}
							</div>
						</div>

						<!-- Actions -->
						<div class="mt-8 pt-6 border-t border-gray-200">
							<div class="flex flex-wrap gap-3">
								<button
									onclick="shareArticle()"
									class="flex items-center gap-1.5 px-4 py-2 bg-hs-blue text-white text-sm rounded-lg hover:bg-hs-blue-light transition-colors duration-200"
								>
									<Share2 className="h-4 w-4" />
									Compartir
								</button>
								<a
									href="/blog"
									class="flex items-center gap-1.5 px-4 py-2 border border-gray-200 text-gray-600 text-sm rounded-lg hover:bg-gray-50 transition-colors duration-200"
								>
									<ArrowLeft className="h-4 w-4" />
									Volver al blog
								</a>
							</div>
						</div>
					</article>

					<!-- Sidebar -->
					<aside class="hidden xl:block">
						<div class="sticky top-40 space-y-6">
							<!-- Support CTA -->
							<div class="bg-hs-blue rounded-xl p-5 text-white">
								<p class="text-xs font-medium text-white/50 uppercase tracking-wider mb-3">Soporte Especializado</p>
								<h3 class="text-base font-bold mb-1.5">
									¿Necesitas ayuda con Softland?
								</h3>
								<p class="text-sm text-blue-100/60 mb-4">
									20+ años de experiencia te respaldan
								</p>

								<div class="space-y-2">
									<a
										href="tel:800914659"
										class="flex items-center gap-2.5 bg-white/10 border border-white/10 rounded-lg p-2.5 hover:bg-white/15 transition-colors duration-200 text-sm"
									>
										<span class="font-medium">800 914 659</span>
										<span class="text-white/50 text-xs">Llamar</span>
									</a>
									<a
										href="https://wa.me/+56800914659?text=Hola,%20necesito%20soporte%20técnico%20para%20Softland%20ERP"
										target="_blank"
										rel="noopener noreferrer"
										class="flex items-center gap-2.5 bg-white/10 border border-white/10 rounded-lg p-2.5 hover:bg-white/15 transition-colors duration-200 text-sm"
									>
										<span class="font-medium">WhatsApp</span>
										<span class="text-white/50 text-xs">En línea</span>
									</a>
									<a
										href="mailto:contacto@hostingsistemas.cl?subject=Soporte%20Técnico%20Softland%20ERP"
										class="flex items-center gap-2.5 bg-white/10 border border-white/10 rounded-lg p-2.5 hover:bg-white/15 transition-colors duration-200 text-sm"
									>
										<span class="font-medium">Email</span>
										<span class="text-white/50 text-xs">Escribir</span>
									</a>
								</div>
							</div>
						</div>
					</aside>
				</div>

				<!-- Mobile Support CTA -->
				<div class="xl:hidden mx-auto mt-10 max-w-4xl">
					<div class="bg-hs-blue rounded-xl p-5 text-white">
						<div class="text-center mb-4">
							<p class="text-xs font-medium text-white/50 uppercase tracking-wider mb-2">Soporte Especializado</p>
							<h3 class="text-base font-bold">¿Necesitas ayuda con Softland?</h3>
						</div>
						<div class="grid grid-cols-3 gap-2">
							<a href="tel:800914659" class="flex items-center justify-center gap-1.5 bg-white/10 border border-white/10 rounded-lg p-2.5 hover:bg-white/15 transition-colors duration-200 text-sm font-medium">
								Teléfono
							</a>
							<a href="https://wa.me/+56800914659?text=Hola,%20necesito%20soporte%20técnico%20para%20Softland%20ERP" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center gap-1.5 bg-white/10 border border-white/10 rounded-lg p-2.5 hover:bg-white/15 transition-colors duration-200 text-sm font-medium">
								WhatsApp
							</a>
							<a href="mailto:contacto@hostingsistemas.cl?subject=Soporte%20Técnico%20Softland%20ERP" class="flex items-center justify-center gap-1.5 bg-white/10 border border-white/10 rounded-lg p-2.5 hover:bg-white/15 transition-colors duration-200 text-sm font-medium">
								Email
							</a>
						</div>
					</div>
				</div>

				<!-- Related Posts -->
				{relatedPosts.length > 0 && (
					<div class="mx-auto mt-14 pt-10 border-t border-gray-200">
						<h2 class="text-xl font-bold text-gray-900 mb-6">Artículos relacionados</h2>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
							{relatedPosts.map((relPost) => (
								<a href={`/blog/${relPost.slug}`} class="group border border-gray-200 rounded-xl p-5 hover:border-hs-blue/30 hover:shadow-sm transition-all duration-200 block">
									<h3 class="text-sm font-semibold text-gray-900 group-hover:text-hs-blue transition-colors duration-200 mb-2 line-clamp-2">
										{relPost.data.title}
									</h3>
									<p class="text-xs text-gray-500 line-clamp-2">
										{relPost.data.description}
									</p>
								</a>
							))}
						</div>
					</div>
				)}

				<!-- Services -->
				<div class="mx-auto mt-14 pt-10 border-t border-gray-200 max-w-6xl">
					<h2 class="text-xl font-bold text-gray-900 mb-6 text-center">Nuestros Servicios</h2>
					<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
						<a href="/servicios/hosting-softland-erp" class="group border border-gray-200 rounded-xl p-5 hover:border-hs-blue/30 hover:shadow-sm transition-all duration-200 flex flex-col">
							<h3 class="text-sm font-semibold text-gray-900 group-hover:text-hs-blue transition-colors duration-200 mb-2">
								Hosting Softland ERP
							</h3>
							<p class="text-xs text-gray-500 leading-5 mb-3 flex-1">
								Infraestructura especializada y optimizada para Softland ERP con servidores dedicados Windows Chile.
							</p>
							<span class="text-xs font-medium text-hs-blue">Ver más</span>
						</a>
						<a href="/servicios/sincronizacion" class="group border border-gray-200 rounded-xl p-5 hover:border-hs-blue/30 hover:shadow-sm transition-all duration-200 flex flex-col">
							<h3 class="text-sm font-semibold text-gray-900 group-hover:text-hs-blue transition-colors duration-200 mb-2">
								ERPSync - Sincronización
							</h3>
							<p class="text-xs text-gray-500 leading-5 mb-3 flex-1">
								Conecta tu e-commerce con Softland ERP. Sincronización automática cada 5 minutos entre plataformas.
							</p>
							<span class="text-xs font-medium text-hs-blue">Ver más</span>
						</a>
						<a href="/servicios/soporte-softland-erp" class="group border border-gray-200 rounded-xl p-5 hover:border-hs-blue/30 hover:shadow-sm transition-all duration-200 flex flex-col">
							<h3 class="text-sm font-semibold text-gray-900 group-hover:text-hs-blue transition-colors duration-200 mb-2">
								Soporte Técnico Experto
							</h3>
							<p class="text-xs text-gray-500 leading-5 mb-3 flex-1">
								Asistencia técnica especializada en Softland ERP con 20+ años de experiencia en Chile.
							</p>
							<span class="text-xs font-medium text-hs-blue">Ver más</span>
						</a>
					</div>
				</div>

				<!-- Back to Blog -->
				<div class="mx-auto mt-10">
					<a href="/blog" class="inline-flex items-center gap-1.5 text-sm text-hs-blue font-medium hover:text-hs-blue-light transition-colors duration-200">
						<ArrowLeft className="h-4 w-4" />
						Volver al blog
					</a>
				</div>
			</div>
		</div>
	</MainLayout>
</Layout>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>

<style is:global>
	/* Reset inline code styles inside code blocks (markdown content) */
	.prose pre code {
		background: transparent !important;
		padding: 0 !important;
		border-radius: 0 !important;
		font-size: inherit !important;
		color: inherit !important;
	}

	/* Download button styling for blog content */
	.prose .download-btn {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		background: #0048AB;
		color: white;
		padding: 0.75rem 1.5rem;
		border-radius: 0.5rem;
		font-weight: 600;
		font-size: 0.875rem;
		text-decoration: none !important;
		box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
		transition: all 0.2s ease;
	}
	.prose .download-btn:hover {
		background: #0058D6;
		color: white;
		box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
	}
</style>
