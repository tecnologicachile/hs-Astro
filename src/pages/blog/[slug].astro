---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import MainLayout from '../../components/Layout.tsx';
import { Calendar, Clock, User, ArrowLeft, Tag, Share2, Bookmark, BookOpen } from 'lucide-react';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

const post = Astro.props;
const { Content } = await post.render();

// Get related posts (same category, excluding current)
const allPosts = await getCollection('blog');
const relatedPosts = allPosts
  .filter(p => p.data.category === post.data.category && p.slug !== post.slug)
  .slice(0, 3);
---

<Layout title={`${post.data.title} | Blog - Hosting Sistemas`}>
	<MainLayout client:load>
		<!-- Hero Section -->
		<div class="bg-gradient-to-br from-hs-blue via-hs-blue-light to-blue-400 py-16 sm:py-20">
			<div class="mx-auto max-w-7xl px-6 lg:px-8">
				<div class="mx-auto max-w-4xl">
					<!-- Breadcrumb -->
					<nav class="flex items-center gap-2 text-sm text-blue-100 mb-8">
						<a href="/" class="hover:text-white transition-colors">Inicio</a>
						<span>/</span>
						<a href="/blog" class="hover:text-white transition-colors">Blog</a>
						<span>/</span>
						<span class="text-white">{post.data.category}</span>
					</nav>
					
					<!-- Category Badge -->
					<div class="mb-6">
						<span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-white/20 backdrop-blur-sm text-white border border-white/30">
							{post.data.category}
						</span>
					</div>
					
					<!-- Title -->
					<h1 class="text-4xl sm:text-5xl font-bold tracking-tight text-white leading-tight font-poppins mb-6">
						{post.data.title}
					</h1>
					
					<!-- Meta Information -->
					<div class="flex flex-wrap items-center gap-6 text-blue-100">
						<div class="flex items-center gap-2">
							<User className="h-5 w-5" />
							<span>{post.data.author}</span>
						</div>
						<div class="flex items-center gap-2">
							<Calendar className="h-5 w-5" />
							<time datetime={post.data.pubDate.toISOString()}>
								{post.data.pubDate.toLocaleDateString('es-CL', { 
									year: 'numeric', 
									month: 'long', 
									day: 'numeric' 
								})}
							</time>
						</div>
						<div class="flex items-center gap-2">
							<Clock className="h-5 w-5" />
							<span>5 min de lectura</span>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Content Section -->
		<div class="bg-white py-12 sm:py-16">
			<div class="mx-auto max-w-7xl px-6 lg:px-8">
				<div class="mx-auto">
					<div class="flex gap-12">
						<!-- Main Content -->
						<article class="flex-1 min-w-0 max-w-5xl">
							<!-- Featured Image -->
							{post.data.image && (
								<div class="mb-12 rounded-2xl overflow-hidden shadow-lg">
									<img 
										src={post.data.image} 
										alt={post.data.title}
										class="w-full h-auto"
									/>
								</div>
							)}
							
							<!-- Article Content -->
							<div class="prose prose-lg max-w-none font-poppins
								prose-headings:font-bold prose-headings:text-gray-900
								prose-h1:text-4xl prose-h1:mb-8 prose-h1:mt-12
								prose-h2:text-3xl prose-h2:mb-6 prose-h2:mt-10
								prose-h3:text-2xl prose-h3:mb-4 prose-h3:mt-8
								prose-p:text-gray-600 prose-p:leading-relaxed prose-p:mb-4
								prose-a:text-hs-blue prose-a:no-underline hover:prose-a:text-hs-blue-light
								prose-strong:text-gray-900 prose-strong:font-semibold
								prose-ul:my-4 prose-ul:space-y-2
								prose-ol:my-4 prose-ol:space-y-2
								prose-li:text-gray-600
								prose-blockquote:border-l-4 prose-blockquote:border-hs-blue prose-blockquote:pl-6 prose-blockquote:italic prose-blockquote:text-gray-700 prose-blockquote:my-6
								prose-code:bg-gray-100 prose-code:px-2 prose-code:py-1 prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:text-gray-800 prose-code:before:content-none prose-code:after:content-none
								prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:p-6 prose-pre:rounded-xl prose-pre:overflow-x-auto prose-pre:my-6">
								<Content />
							</div>
							
							<!-- Tags -->
							<div class="mt-12 pt-8 border-t border-gray-200">
								<div class="flex items-center gap-3 flex-wrap">
									<Tag className="h-5 w-5 text-gray-400" />
									{post.data.tags.map((tag: string) => (
										<span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors cursor-pointer">
											{tag}
										</span>
									))}
								</div>
							</div>
							
							<!-- Share Section -->
							<div class="mt-8 p-6 bg-gray-50 rounded-2xl">
								<div class="flex items-center justify-between">
									<div>
										<h3 class="text-lg font-semibold text-gray-900 mb-2">¿Te gustó este artículo?</h3>
										<p class="text-sm text-gray-600">Compártelo con tu red</p>
									</div>
									<div class="flex items-center gap-3">
										<button class="p-3 bg-white rounded-lg hover:bg-gray-100 transition-colors">
											<Share2 className="h-5 w-5 text-gray-600" />
										</button>
										<button class="p-3 bg-white rounded-lg hover:bg-gray-100 transition-colors">
											<Bookmark className="h-5 w-5 text-gray-600" />
										</button>
									</div>
								</div>
							</div>
						</article>
						
						<!-- Sidebar -->
						<aside class="hidden lg:block w-80 flex-shrink-0">
							<!-- Sticky Container -->
							<div class="sticky top-24 space-y-6">
								<!-- Servicios Relacionados -->
								<div class="bg-white border border-gray-200 rounded-xl p-5">
									<h4 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-4">Servicios Relacionados</h4>
									
									<!-- Hosting Softland -->
									<a href="/servicios/hosting-softland-erp" class="block group mb-4 pb-4 border-b border-gray-100 last:border-0 last:pb-0 last:mb-0">
										<div class="flex items-start gap-3">
											<div class="w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center flex-shrink-0 group-hover:bg-blue-100 transition-colors">
												<svg class="w-5 h-5 text-hs-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/>
												</svg>
											</div>
											<div class="flex-1">
												<h5 class="text-sm font-semibold text-gray-900 group-hover:text-hs-blue transition-colors mb-1">
													Hosting Softland
												</h5>
												<p class="text-xs text-gray-600 leading-relaxed">
													Infraestructura optimizada para Softland ERP
												</p>
											</div>
										</div>
									</a>
									
									<!-- ERPSync -->
									<a href="/servicios/sincronizacion" class="block group mb-4 pb-4 border-b border-gray-100 last:border-0 last:pb-0 last:mb-0">
										<div class="flex items-start gap-3">
											<div class="w-10 h-10 bg-orange-50 rounded-lg flex items-center justify-center flex-shrink-0 group-hover:bg-orange-100 transition-colors">
												<svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
												</svg>
											</div>
											<div class="flex-1">
												<h5 class="text-sm font-semibold text-gray-900 group-hover:text-orange-500 transition-colors mb-1">
													ERPSync
												</h5>
												<p class="text-xs text-gray-600 leading-relaxed">
													Sincronización WooCommerce + Softland
												</p>
											</div>
										</div>
									</a>
									
									<!-- Soporte -->
									<a href="/servicios/soporte-softland-erp" class="block group">
										<div class="flex items-start gap-3">
											<div class="w-10 h-10 bg-green-50 rounded-lg flex items-center justify-center flex-shrink-0 group-hover:bg-green-100 transition-colors">
												<svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/>
												</svg>
											</div>
											<div class="flex-1">
												<h5 class="text-sm font-semibold text-gray-900 group-hover:text-green-600 transition-colors mb-1">
													Soporte 24/7
												</h5>
												<p class="text-xs text-gray-600 leading-relaxed">
													Asistencia técnica especializada
												</p>
											</div>
										</div>
									</a>
								</div>

								<!-- Recursos útiles -->
								<div class="bg-gray-50 rounded-xl p-5">
									<h4 class="text-sm font-semibold text-gray-700 mb-3">Recursos útiles</h4>
									<ul class="space-y-2">
										<li>
											<a href="/blog" class="text-sm text-gray-600 hover:text-hs-blue transition-colors flex items-center gap-2">
												<span class="text-gray-400">→</span>
												Más artículos del blog
											</a>
										</li>
										<li>
											<a href="/contacto" class="text-sm text-gray-600 hover:text-hs-blue transition-colors flex items-center gap-2">
												<span class="text-gray-400">→</span>
												Solicitar asesoría
											</a>
										</li>
										<li>
											<a href="/servicios" class="text-sm text-gray-600 hover:text-hs-blue transition-colors flex items-center gap-2">
												<span class="text-gray-400">→</span>
												Ver todos los servicios
											</a>
										</li>
									</ul>
								</div>

								<!-- Newsletter sutil -->
								<div class="bg-white border border-gray-200 rounded-xl p-5">
									<h4 class="text-sm font-semibold text-gray-700 mb-2">Mantente informado</h4>
									<p class="text-xs text-gray-600 mb-3">
										Recibe tips y novedades sobre Softland ERP
									</p>
									<form class="space-y-2">
										<input
											type="email"
											placeholder="Tu email"
											class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-hs-blue focus:border-hs-blue"
										/>
										<button
											type="submit"
											class="w-full px-3 py-2 bg-hs-blue text-white text-sm rounded-lg hover:bg-hs-blue-light transition-colors"
										>
											Suscribirse
										</button>
									</form>
								</div>
							</div>
						</aside>
					</div>
				</div>
				
				<!-- Related Posts -->
				{relatedPosts.length > 0 && (
					<div class="mx-auto mt-16 pt-16 border-t border-gray-200">
						<h2 class="text-2xl font-bold text-gray-900 mb-8 font-poppins">Artículos relacionados</h2>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
							{relatedPosts.map((relPost) => (
								<article class="group">
									<a href={`/blog/${relPost.slug}`} class="block">
										{relPost.data.image ? (
											<div class="aspect-w-16 aspect-h-9 mb-4 rounded-xl overflow-hidden bg-gray-200">
												<img
													src={relPost.data.image}
													alt={relPost.data.title}
													class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
												/>
											</div>
										) : (
											<div class="mb-4 rounded-xl overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 h-48 flex items-center justify-center">
												<BookOpen className="h-12 w-12 text-gray-400" />
											</div>
										)}
										<h3 class="text-lg font-semibold text-gray-900 group-hover:text-hs-blue transition-colors mb-2 line-clamp-2">
											{relPost.data.title}
										</h3>
										<p class="text-sm text-gray-600 line-clamp-2">
											{relPost.data.description}
										</p>
									</a>
								</article>
							))}
						</div>
					</div>
				)}
				
				<!-- Back to Blog -->
				<div class="mx-auto mt-12">
					<a href="/blog" class="inline-flex items-center gap-2 text-hs-blue font-semibold hover:text-hs-blue-light transition-colors">
						<ArrowLeft className="h-5 w-5" />
						Volver al blog
					</a>
				</div>
			</div>
		</div>
	</MainLayout>
</Layout>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>